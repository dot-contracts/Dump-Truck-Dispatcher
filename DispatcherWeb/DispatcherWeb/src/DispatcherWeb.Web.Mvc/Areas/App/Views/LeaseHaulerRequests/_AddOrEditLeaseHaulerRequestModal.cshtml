@using DispatcherWeb.Infrastructure.Extensions
@using DispatcherWeb.LeaseHaulerRequests.Dto
@using DispatcherWeb.Web.Areas.App.Models.Common.Modals
@model LeaseHaulerRequestEditDto
@await Html.PartialAsync("~/Areas/app/Views/Common/Modals/_ModalHeader.cshtml", new ModalHeaderViewModel(Model.Id == 0 ? "Select Lease Hauler" : "Assign Lease Hauler Trucks"))

<div class="modal-body">
    <form role="form" novalidate class="form-validation">
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="OrderLineId" />
        <input type="hidden" asp-for="Available" />
        <input type="hidden" asp-for="Status" />

        <div class="form-group">
            <label class="control-label required-label" asp-for="Date">Request Date</label>
            <input class="form-control" asp-for="Date" type="text" required autocomplete="off" disabled="@(Model.Date.HasValue || Model.Id != 0 ? "disabled" : null)">
        </div>
        @if (await SettingManager.UseShifts())
        {
            <div class="form-group">
                <label class="control-label required-label" asp-for="Shift">@L("Shift")</label>
                <select class="form-control" id="Shift" asp-for="Shift" asp-items="@(await SettingManager.GetShiftSelectList()).Select(x => new SelectListItem(x.Name, x.Id))" disabled="@(Model.Id != 0 ? "disabled" : null)" required>
                    <option value="">&nbsp;</option>
                </select>
            </div>
        }

        <div class="form-group">
            <label class="control-label required-label" asp-for="LeaseHaulerId">Lease hauler</label>
            <select class="form-control" asp-for="LeaseHaulerId" disabled="@(Model.Id != 0 ? "disabled" : null)" required>
                <option value="">Select a Lease hauler</option>
                @if (Model.LeaseHaulerId != 0)
                {
                    <option selected value="@Model.LeaseHaulerId">@Model.LeaseHaulerName</option>
                }
            </select>
        </div>

        <div class="form-group">
            <label class="control-label required-label">Number Requested</label>
            <input class="form-control" type="text" asp-for="NumberTrucksRequested" required data-rule-number="true" data-rule-digits="true" data-rule-min="1" data-rule-max="1000" disabled="@(Model.Id != 0 ? "disabled" : null)">
        </div>

        <div id="truckSelectionBlock" abp-hidden>
            <br />
            <label>If you have the truck and driver information, you can add it below.</label>

            <div class="form-group m-form__group row align-items-center d-none d-sm-flex pb-0">
                <div class="col-sm-6">
                    <label class="col-xs-12 control-label">@L("Truck"):</label>
                </div>
                <div class="col-sm-5">
                    <label class="col-xs-12 control-label">@L("Driver"):</label>
                </div>
            </div>

            <div id="truckSelectionRowTemplate">
                <div class="form-group m-form__group row align-items-center truck-selection-row" abp-hidden>
                    <div class="col-sm-6">
                        <label class="col-xs-12 d-sm-none control-label">@L("Truck"):</label>
                        <div class="col-xs-12">
                            <select class="form-control lease-hauler-truck-select" name="Trucks[]">
                                <option value="">Select an option</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <label class="col-xs-12 d-sm-none control-label">@L("Driver"):</label>
                        <div class="col-xs-12">
                            <select class="form-control lease-hauler-driver-select" name="Drivers[]">
                                <option value="">Select an option</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="truckSelectionBlockTrucks">
                @for (int i = 0; i < (Math.Max(Model.NumberTrucksRequested ?? 0, Model.RequestedTrucks?.Count ?? 0)); i++)
                {
                    var truck = Model.RequestedTrucks?.Count > i && Model.RequestedTrucks[i].TruckId.HasValue ? Model.RequestedTrucks[i] : null;
                    <div class="form-group m-form__group row align-items-center truck-selection-row">
                        <div class="col-sm-6">
                            <label class="col-xs-12 d-sm-none control-label">@L("Truck"):</label>
                            <div class="col-xs-12">
                                <select class="form-control lease-hauler-truck-select" name="Trucks[]" data-truck-isinuse="@(truck?.IsTruckInUse ?? false)" data-truck-originalid="@(truck?.TruckId ?? 0)">
                                    <option value="">Select an option</option>
                                    @if (truck != null)
                                    {
                                        <option selected value="@truck.TruckId">@truck.TruckCode</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <label class="col-xs-12 d-sm-none control-label">@L("Driver"):</label>
                            <div class="col-xs-12">
                                <select class="form-control lease-hauler-driver-select" name="Drivers[]" data-driver-isinuse="@(truck?.IsDriverInUse ?? false)" data-driver-originalid="@(truck?.DriverId ?? 0)">
                                    <option value="">Select an option</option>
                                    @if (Model.RequestedTrucks?.Count > i && Model.RequestedTrucks[i].DriverId.HasValue)
                                    {
                                        <option selected value="@Model.RequestedTrucks[i].DriverId">@Model.RequestedTrucks[i].DriverName</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                }

            </div>
        </div>

    </form>
</div>

@await Html.PartialAsync("~/Areas/app/Views/Common/Modals/_ModalFooterWithSaveAndCancel.cshtml")
